<!-- app.component.html -->
<div class="container">
  <!-- Error Modal -->
  <div class="error-modal" *ngIf="showErrorModal">
    <div class="error-modal-content">
      <div class="error-modal-title">
        âš ï¸ BÅ‚Ä…d walidacji
      </div>
      <div class="error-modal-list">
        <div class="error-item" *ngFor="let error of errorMessages">
          <span class="error-icon">âœ•</span>
          {{ error }}
        </div>
      </div>
      <button class="error-modal-button" (click)="closeErrorModal()">Zamknij</button>
    </div>
  </div>

  <header>
    <h1>ğŸ” Portal Rzeczy Znalezionych</h1>
    <p>dane.gov.pl - Szybkie udostÄ™pnianie danych</p>
  </header>

  <div class="content">
    <div class="progress-bar">
      <div class="progress-fill" [style.width.%]="getProgress()"></div>
    </div>

    <div class="step-indicator">
      <div *ngFor="let i of [1,2,3,4]" 
           class="step-dot"
           [ngClass]="{'active': isStepActive(i), 'completed': isStepCompleted(i)}">
        {{ i }}
      </div>
    </div>

    <form [formGroup]="form">
      <!-- KROK 1: Dane samorzÄ…du -->
      <div class="wizard" *ngIf="currentStep === 1">
        <h2 class="step-title">Krok 1/4: Dane SamorzÄ…du</h2>
        <p class="step-description">UzupeÅ‚nij podstawowe informacje o samorzÄ…dzie</p>
        
        <div class="form-row">
          <div class="form-group">
            <label for="municipalityType">Typ samorzÄ…du *</label>
            <select 
              id="municipalityType" 
              formControlName="municipalityType"
              required>
              <option value="">Wybierz...</option>
              <option *ngFor="let type of municipalityTypes" [value]="type.value">
                {{ type.label }}
              </option>
            </select>
          </div>
        </div>

        <div class="form-group" style="position: relative;">
          <label for="municipalityName">Nazwa samorzÄ…du *</label>
          <input 
            type="text" 
            id="municipalityName" 
            formControlName="municipalityName"
            placeholder="Zacznij pisaÄ‡ nazwÄ™... (np. Warszawa, Powiat krakowski)"
            (input)="onMunicipalityNameInput()"
            (focus)="onMunicipalityNameInput()"
            (blur)="hideAutocomplete()"
            autocomplete="off"
            required>
          
          <!-- Lista autouzupeÅ‚niania -->
          <div 
            *ngIf="showAutocomplete && filteredUnits.length > 0" 
            class="autocomplete-list">
            <div 
              *ngFor="let unit of filteredUnits" 
              class="autocomplete-item"
              (click)="selectUnit(unit)">
              <strong>{{ unit.name }}</strong>
              <span class="autocomplete-type">{{ unit.type }}</span>
              <span class="autocomplete-context" *ngIf="unit.parentName">
                woj. {{ unit.parentName }}
              </span>
            </div>
          </div>
          
          <small style="color: #666; font-size: 12px; margin-top: 4px; display: block;">
            ğŸ’¡ Wybierz najpierw typ samorzÄ…du, nastÄ™pnie zacznij pisaÄ‡ nazwÄ™ aby zobaczyÄ‡ podpowiedzi
          </small>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="contactEmail">Email kontaktowy *</label>
            <input 
              type="email" 
              id="contactEmail" 
              formControlName="contactEmail"
              placeholder="kontakt@samorzad.pl"
              required>
            <small style="color: #666; font-size: 12px; margin-top: 4px; display: block;">
              âœ¨ Email uzupeÅ‚ni siÄ™ automatycznie po wybraniu urzÄ™du (moÅ¼esz edytowaÄ‡)
            </small>
          </div>
        </div>

        <div class="buttons">
          <button type="button" class="btn-primary" (click)="nextStep()">Dalej â†’</button>
        </div>
      </div>

      <!-- KROK 2: Dane przedmiotu -->
      <div class="wizard" *ngIf="currentStep === 2">
        <h2 class="step-title">Krok 2/4: Dodaj Rzecz ZnalezionÄ…</h2>
        <p class="step-description">Wpisz szczegÃ³Å‚y znalezionego przedmiotu</p>
        
        <div class="form-group">
          <label for="itemName">Nazwa przedmiotu *</label>
          <input 
            type="text" 
            id="itemName" 
            formControlName="itemName"
            placeholder="np. Czarny portfel"
            required>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="itemCategory">Kategoria *</label>
            <select 
              id="itemCategory" 
              formControlName="itemCategory"
              required>
              <option value="">Wybierz kategoriÄ™...</option>
              <option *ngFor="let cat of categories" [value]="cat.value">
                {{ cat.label }}
              </option>
            </select>
          </div>
          <div class="form-group">
            <label for="itemDate">Data znalezienia *</label>
            <input 
              type="date" 
              id="itemDate" 
              formControlName="itemDate"
              required>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="itemLocation">Miejsce znalezienia *</label>
            <input 
              type="text" 
              id="itemLocation" 
              formControlName="itemLocation"
              placeholder="np. Przystanek autobusowy ul. MarszaÅ‚kowska"
              required>
          </div>
          <div class="form-group">
            <label for="itemStatus">Status *</label>
            <select 
              id="itemStatus" 
              formControlName="itemStatus"
              required>
              <option value="">Wybierz status...</option>
              <option *ngFor="let status of statusOptions" [value]="status.value">
                {{ status.label }}
              </option>
            </select>
          </div>
        </div>

        <div class="form-group">
          <label for="itemDescription">Opis szczegÃ³Å‚owy</label>
          <textarea 
            id="itemDescription" 
            formControlName="itemDescription"
            placeholder="Dodatkowe szczegÃ³Å‚y, znaki szczegÃ³lne, itp."></textarea>
        </div>

        <div class="buttons">
          <button type="button" class="btn-secondary" (click)="prevStep()">â† Wstecz</button>
          <button type="button" class="btn-primary" (click)="nextStep()">Dalej â†’</button>
        </div>
      </div>

      <!-- KROK 3: Warunki odbioru -->
      <div class="wizard" *ngIf="currentStep === 3">
        <h2 class="step-title">Krok 3/4: Warunki Odbioru</h2>
        <p class="step-description">Podaj informacje o warunkach przechowywania i odbioru</p>
        
        <div class="form-row">
          <div class="form-group">
            <label for="storageDeadline">Termin przechowywania (dni) *</label>
            <input 
              type="number" 
              id="storageDeadline" 
              formControlName="storageDeadline"
              min="1" 
              max="365" 
              required>
          </div>
          <div class="form-group">
            <label for="pickupLocation">Miejsce odbioru *</label>
            <input 
              type="text" 
              id="pickupLocation" 
              formControlName="pickupLocation"
              placeholder="np. Biuro Stanu Cywilnego, ul. MarszaÅ‚kowska 5"
              required>
          </div>
        </div>

        <div class="form-group">
          <label for="pickupHours">Godziny dostÄ™pnoÅ›ci</label>
          <input 
            type="text" 
            id="pickupHours" 
            formControlName="pickupHours"
            placeholder="np. Pn-Pt 8:00-16:00">
        </div>

        <div class="form-group">
          <label for="contactPerson">Osoba do kontaktu</label>
          <input 
            type="text" 
            id="contactPerson" 
            formControlName="contactPerson"
            placeholder="ImiÄ™ i nazwisko">
        </div>

        <div class="buttons">
          <button type="button" class="btn-secondary" (click)="prevStep()">â† Wstecz</button>
          <button type="button" class="btn-primary" (click)="nextStep()">Dalej â†’</button>
        </div>
      </div>

      <!-- KROK 4: Podsumowanie -->
      <div class="wizard" *ngIf="currentStep === 4">
        <h2 class="step-title">Krok 4/4: Podsumowanie i UdostÄ™pnienie</h2>
        <p class="step-description">Przejrzyj dane i wybierz format eksportu</p>
        
        <div class="summary">
          <div class="summary-item">
            <span class="summary-label">SamorzÄ…d:</span>
            <span class="summary-value">{{ form.get('municipalityName')?.value }} ({{ form.get('municipalityType')?.value }})</span>
          </div>
          <div class="summary-item">
            <span class="summary-label">Przedmiot:</span>
            <span class="summary-value">{{ form.get('itemName')?.value }}</span>
          </div>
          <div class="summary-item">
            <span class="summary-label">Kategoria:</span>
            <span class="summary-value">{{ form.get('itemCategory')?.value }}</span>
          </div>
          <div class="summary-item">
            <span class="summary-label">Data znalezienia:</span>
            <span class="summary-value">{{ form.get('itemDate')?.value }}</span>
          </div>
          <div class="summary-item">
            <span class="summary-label">Miejsce znalezienia:</span>
            <span class="summary-value">{{ form.get('itemLocation')?.value }}</span>
          </div>
          <div class="summary-item">
            <span class="summary-label">OdbiÃ³r:</span>
            <span class="summary-value">{{ form.get('pickupLocation')?.value }}</span>
          </div>
        </div>

        <p style="font-weight: 500; margin-bottom: 12px;">Wybierz format eksportu:</p>
        <div class="export-buttons">
          <button type="button" class="btn-primary" (click)="exportJSON()">ğŸ“„ Pobierz JSON</button>
          <button type="button" class="btn-primary" (click)="exportCSV()">ğŸ“Š Pobierz CSV</button>
        </div>

        <div style="background: #f0f7ff; border: 1px solid #b3d9ff; border-radius: 8px; padding: 15px; margin-top: 20px; margin-bottom: 20px; max-height: 200px; overflow-y: auto;">
          <p style="font-size: 12px; font-weight: 600; color: #003399; margin-bottom: 10px;">Preview JSON:</p>
          <pre style="font-size: 11px; color: #333; margin: 0; font-family: 'Courier New', monospace; white-space: pre-wrap; word-break: break-word;">{{ getFormDataPreview() }}</pre>
        </div>

        <div class="buttons">
          <button type="button" class="btn-secondary" (click)="prevStep()">â† Wstecz</button>
          <button type="button" class="btn-primary" (click)="submitData()">âœ“ UdostÄ™pnij w portalu</button>
        </div>
      </div>
    </form>

    <!-- Lista wgranych rekordÃ³w -->
    <div *ngIf="items.length > 0" class="records-section">
      <h3>ğŸ“‹ Dodane rekordy ({{ items.length }})</h3>
      <div *ngFor="let item of items" class="record-item">
        <div>
          <strong>{{ item.item.name }}</strong>
          <span style="color: #999; font-size: 13px; margin-left: 8px;">{{ item.item.date }}</span>
        </div>
        <div style="font-size: 13px; color: #666; margin-top: 8px;">
          ğŸ›ï¸ {{ item.municipality.name }} ğŸ“ {{ item.item.location }}
        </div>
        <div style="font-size: 12px; color: #999; margin-top: 6px;">
          ID: {{ item.id }}
        </div>
      </div>
    </div>
  </div>
</div>